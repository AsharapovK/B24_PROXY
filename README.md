![Node.js](https://img.shields.io/badge/Node.js-v18+-green) ![Express](https://img.shields.io/badge/Express-v4.x-blue) ![Swagger](https://img.shields.io/badge/Swagger-OpenAPI-85EA2D) ![License](https://img.shields.io/badge/License-MIT-yellow)

# B24 Proxy

ะัะพะบัะธ-ัะตัะฒะตั ะดะปั ะพะฑัะฐะฑะพัะบะธ ะธ ะผะฐัััััะธะทะฐัะธะธ ะทะฐะฟัะพัะพะฒ ั ะธะฝัะตะณัะฐัะธะตะน ะฒ Bitrix24. ะฃะฟัะฐะฒะปัะตั ะพัะตัะตะดัั, ะปะพะณะธัะพะฒะฐะฝะธะตะผ ะธ ะทะฐัะธัะพะน ะพั ะฟะตัะตะณััะทะบะธ API.

---

## ๐ ะัััััะน ััะฐัั

### 1. ะฃััะฐะฝะพะฒะบะฐ Node.js

ะฃะฑะตะดะธัะตัั, ััะพ ั ะฒะฐั ัััะฐะฝะพะฒะปะตะฝ Node.js ะฒะตััะธะธ 18 ะธะปะธ ะฒััะต. ะัะปะธ ะฝะตั, ัะบะฐัะฐะนัะต ะธ ัััะฐะฝะพะฒะธัะต ั [ะพัะธัะธะฐะปัะฝะพะณะพ ัะฐะนัะฐ](https://nodejs.org/).

ะัะพะฒะตัะบะฐ ะฒะตััะธะธ:
```bash
node -v
# ะะพะปะถะฝะพ ะฑััั v18.x.x ะธะปะธ ะฒััะต
```

### 2. ะะปะพะฝะธัะพะฒะฐะฝะธะต ะธ ะฝะฐัััะพะนะบะฐ

```bash
# ะะปะพะฝะธััะนัะต ัะตะฟะพะทะธัะพัะธะน
git clone https://github.com/AsharapovK/B24_PROXY.git
cd B24_PROXY

# ะฃััะฐะฝะพะฒะธัะต ะทะฐะฒะธัะธะผะพััะธ
npm install
```

### 3. ะะฐัััะพะนะบะฐ ะบะพะฝัะธะณััะฐัะธะธ

ะกะพะทะดะฐะนัะต ัะฐะนะป ะบะพะฝัะธะณััะฐัะธะธ, ัะบะพะฟะธัะพะฒะฐะฒ ะฟัะธะผะตั:
```bash
cp config/proxy-config.example.cjs config/proxy-config.cjs
```

ะััะตะดะฐะบัะธััะนัะต ัะฐะนะป `config/proxy-config.cjs` ะธ ัะบะฐะถะธัะต ะฒะฐัะธ ะฝะฐัััะพะนะบะธ:
- `TARGET_BASE_URL` - ะพัะฝะพะฒะฝะพะน URL ะดะปั ะฟัะพะบัะธัะพะฒะฐะฝะธั ะทะฐะฟัะพัะพะฒ
- `TARGET_BASE_URL_INVOICE` - URL ะดะปั ะฟัะพะบัะธัะพะฒะฐะฝะธั ะทะฐะฟัะพัะพะฒ ะบ ััะตัะฐะผ
- `MAX_CONCURRENCY` - ะผะฐะบัะธะผะฐะปัะฝะพะต ะบะพะปะธัะตััะฒะพ ะพะดะฝะพะฒัะตะผะตะฝะฝัั ะทะฐะฟัะพัะพะฒ

### 4. ะะฐะฟััะบ

ะะปั ัะฐะทัะฐะฑะพัะบะธ:
```bash
npm run dev
```

ะะปั ะฟัะพะดะฐะบัะตะฝะฐ:
```bash
npm start
```

ะัะธะปะพะถะตะฝะธะต ะฑัะดะตั ะดะพัััะฟะฝะพ ะฟะพ ะฐะดัะตัั: http://127.0.0.1:7777

---

## โ๏ธ ะะพะฝัะธะณััะฐัะธั

ะัะต ะฟะฐัะฐะผะตััั ัะตัะฒะตัะฐ ะฝะฐัััะฐะธะฒะฐัััั ัะตัะตะท ัะฐะนะป `config/proxy-config.cjs`.

ะัะธะผะตั ะบะปััะตะฒัั ะฟะฐัะฐะผะตััะพะฒ:

```js
module.exports = {
  SERVER_IP: "127.0.0.1",
  PROXY_PORT: 7777,
  TARGET_BASE_URL: "https://script.google.com/macros/s/xxxxxxxxxxxxxxxxxxxxxxx/exec",
  TARGET_BASE_URL_INVOICE: "https://script.google.com/macros/s/xxxxxxxxxxxxxxxxxxxxxxx/exec",
  REQUEST_TIMEOUT: 360000,
  MAX_RETRIES: 3,
  MAX_CONCURRENCY: 1,
};
```

ะะปั ะฝะฐัััะพะนะบะธ ะฟัะพะบัะธ ะฒะพ ััะพะฝัะตะฝะดะต ะธัะฟะพะปัะทัะนัะต ัะฐะนะป `vite.config.js`:

```js
server: {
  proxy: {
    "/api": {
      target: "http://127.0.0.1:7777",
      changeOrigin: true,
      ws: true,
    },
  },
},
```

---

## ๐ ะัะฝะพะฒะฝัะต ะฒะพะทะผะพะถะฝะพััะธ

- ะัะตัะตะดั ะทะฐะฟัะพัะพะฒ ั ะพะณัะฐะฝะธัะตะฝะธะตะผ ัะบะพัะพััะธ (p-queue)
- ะะฒัะพะผะฐัะธัะตัะบะธะต ะฟะพะฒัะพัั ะฟัะธ ะพัะธะฑะบะฐั
- ะะพะดัะพะฑะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต (winston)
- ะะตะฑ-ะธะฝัะตััะตะนั ะดะปั ะปะพะณะพะฒ (`/logs`)
- ะะพะบัะผะตะฝัะฐัะธั API ัะตัะตะท Swagger UI (`/api-docs`)
- ะะธะฑะบะฐั ะบะพะฝัะธะณััะฐัะธั ัะตัะตะท ัะฐะนะปั ะบะพะฝัะธะณััะฐัะธะธ
- ะะพะฝะธัะพัะธะฝะณ ะพัะตัะตะดะธ ะธ ััะฐัะธััะธะบะธ

---

## ๐ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ  Bitrix24   โโโโโถโ  ะัะพะบัะธ-ัะตัะฒะตั โโโโโถโ  ะฆะตะปะตะฒะพะต API    โ
โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
                        โ
                        โผ
                โโโโโโโโโโโโโโโโโ
                โ  ะัะตัะตะดั     โ
                โ  (p-queue)   โ
                โโโโโโโโโโโโโโโโโ
                        โ
                        โผ
                โโโโโโโโโโโโโโโโโ
                โ  ะะพะณะธัะพะฒะฐะฝะธะต  โ
                โ  (winston)    โ
                โโโโโโโโโโโโโโโโโ
```

---

## ๐ API ะะพะบัะผะตะฝัะฐัะธั

Swagger UI: [http://127.0.0.1:7777/api-docs](http://127.0.0.1:7777/api-docs)

### ะัะธะผะตัั ัะฝะดะฟะพะธะฝัะพะฒ

- **ะะพะฑะฐะฒะธัั ะทะฐะฟัะพั ะฒ ะพัะตัะตะดั**
  ```http
  POST /proxy?DealID=123&param1=value1
  ```
- **ะัะพะฒะตัะธัั ััะฐััั ะฟะพ dealId**
  ```http
  GET /api/queue/position?dealId=DEAL123
  ```
- **ะัะพะฒะตัะธัั ััะฐััั ะฟะพ invoiceId**
  ```http
  GET /api/queue/position?invoiceId=INV123
  ```
- **ะกัะฐัะธััะธะบะฐ ะพัะตัะตะดะธ**
  ```http
  GET /api/queue
  ```
- **ะัะพัะผะพัั ะปะพะณะพะฒ**
  ```http
  GET /api/logs
  ```

---

## ๐ ะะฐะฟััะบ

```bash
npm install
npm run dev
```

- ะกะตัะฒะตั: http://127.0.0.1:7777
- ะคัะพะฝัะตะฝะด: http://127.0.0.1:5173

---

## ๐ ะะธัะตะฝะทะธั

MIT

---

**ะะฒัะพั:** Asharapov Kirill  
**ะะตััะธั:** 3.2.1  
**ะะฐัะฐ:** 2025-07-24
